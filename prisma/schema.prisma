generator client {
  provider = "prisma-client-js"
  output   = "./generated/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AdminSettings {
  id           String   @id @default("singleton")
  featureCosts Json?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model CreditBalance {
  id               String         @id @default(cuid())
  userId           String         @unique
  clerkUserId      String         @unique
  creditsRemaining Int            @default(100)
  lastSyncedAt     DateTime       @default(now())
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  User             User           @relation(fields: [userId], references: [id])
  UsageHistory     UsageHistory[]

  @@index([clerkUserId])
  @@index([creditsRemaining])
  @@index([lastSyncedAt])
  @@index([userId])
}

model CustomFont {
  id         Int      @id @default(autoincrement())
  name       String
  fontFamily String
  fileUrl    String
  projectId  Int
  uploadedBy String
  createdAt  DateTime @default(now())
  Project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
}

model Element {
  id         Int      @id @default(autoincrement())
  name       String
  fileUrl    String
  category   String?
  projectId  Int
  uploadedBy String
  createdAt  DateTime @default(now())
  Project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([projectId])
}

model Feature {
  id          String   @id @default(cuid())
  workspaceId String
  name        String
  description String?
  tags        String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([workspaceId])
}

model Generation {
  id                   String              @id @default(cuid())
  status               GenerationStatus    @default(PROCESSING)
  templateId           Int
  fieldValues          Json
  resultUrl            String?
  projectId            Int
  authorName           String?
  templateName         String?
  projectName          String?
  createdBy            String
  createdAt            DateTime            @default(now())
  completedAt          DateTime?
  googleDriveFileId    String?
  googleDriveBackupUrl String?
  fileName             String?
  Project              Project             @relation(fields: [projectId], references: [id], onDelete: Cascade)
  Template             Template            @relation(fields: [templateId], references: [id], onDelete: Cascade)
  socialPosts          SocialPost[]
  VideoProcessingJob   VideoProcessingJob? @relation("GenerationVideoJob")

  @@index([createdAt])
  @@index([createdBy])
  @@index([projectId])
  @@index([status])
  @@index([templateId])
}

model Logo {
  id            Int      @id @default(autoincrement())
  name          String
  fileUrl       String
  projectId     Int
  uploadedBy    String
  createdAt     DateTime @default(now())
  isProjectLogo Boolean  @default(false)
  Project       Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([projectId, isProjectLogo])
}

model BrandColor {
  id         Int      @id @default(autoincrement())
  name       String
  hexCode    String
  projectId  Int
  uploadedBy String
  createdAt  DateTime @default(now())
  Project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
}

model Plan {
  id                 String   @id @default(cuid())
  clerkId            String?  @unique
  clerkName          String?
  name               String
  credits            Int
  active             Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  currency           String?
  priceMonthlyCents  Int?
  priceYearlyCents   Int?
  badge              String?
  ctaLabel           String?
  ctaType            String?  @default("checkout")
  ctaUrl             String?
  description        String?
  features           Json?
  highlight          Boolean  @default(false)
  billingSource      String   @default("clerk")
  sortOrder          Int      @default(0)
  allowOrgCreation   Boolean  @default(false)
  orgMemberLimit     Int?
  orgProjectLimit    Int?
  orgCreditsPerMonth Int?
  orgCountLimit      Int?

  @@index([active])
}

model Project {
  id                          Int                     @id @default(autoincrement())
  name                        String
  description                 String?
  status                      ProjectStatus           @default(ACTIVE)
  logoUrl                     String?
  googleDriveFolderId         String?
  makeWebhookAnalyzeUrl       String?
  makeWebhookCreativeUrl      String?
  userId                      String
  workspaceId                 Int?
  createdAt                   DateTime                @default(now())
  updatedAt                   DateTime                @updatedAt
  googleDriveFolderName       String?
  googleDriveImagesFolderId   String?
  googleDriveImagesFolderName String?
  googleDriveVideosFolderId   String?
  googleDriveVideosFolderName String?
  instagramAccountId          String?
  instagramUsername           String?
  zapierWebhookUrl            String?
  isClientProject             Boolean                 @default(false)
  instagramUserId             String?
  aiChatBehavior              String?
  laterAccountId              String?
  laterProfileId              String?
  postingProvider             PostingProvider?        @default(ZAPIER)
  webhookReminderUrl          String?
  AIGeneratedImage            AIGeneratedImage[]
  BrandColor                  BrandColor[]
  chatConversations           ChatConversation[]
  clientInvite                ClientInvite?
  CustomFont                  CustomFont[]
  Element                     Element[]
  Generation                  Generation[]
  instagramDailySummary       InstagramDailySummary[]
  instagramFeeds              InstagramFeed[]
  instagramGoalSettings       InstagramGoalSettings?
  instagramStories            InstagramStory[]
  instagramWeeklyReports      InstagramWeeklyReport[]
  Logo                        Logo[]
  musicLibrary                MusicLibrary[]          @relation("ProjectMusicLibrary")
  organizationProjects        OrganizationProject[]
  OrganizationUsage           OrganizationUsage[]
  PromptLibrary               PromptLibrary[]
  SocialPost                  SocialPost[]
  Template                    Template[]
  youtubeDownloads            YoutubeDownloadJob[]
  knowledgeEntries            KnowledgeBaseEntry[]

  @@index([status])
  @@index([userId])
  @@index([workspaceId])
  @@index([userId, updatedAt(sort: Desc)])
  @@index([updatedAt(sort: Desc)])
  @@index([isClientProject])
}

model ClientInvite {
  id                          String             @id @default(cuid())
  email                       String
  clientName                  String?
  projectName                 String
  projectDescription          String?
  googleDriveFolderId         String?
  googleDriveFolderName       String?
  googleDriveImagesFolderId   String?
  googleDriveImagesFolderName String?
  googleDriveVideosFolderId   String?
  googleDriveVideosFolderName String?
  instagramAccountId          String?
  instagramUsername           String?
  zapierWebhookUrl            String?
  clerkInvitationId           String?            @unique
  inviteUrl                   String?
  status                      ClientInviteStatus @default(PENDING)
  invitedBy                   String
  invitedByName               String?
  userId                      String?            @unique
  projectId                   Int?               @unique
  createdAt                   DateTime           @default(now())
  updatedAt                   DateTime           @updatedAt
  acceptedAt                  DateTime?
  completedAt                 DateTime?
  cancelledAt                 DateTime?
  expiresAt                   DateTime?
  project                     Project?           @relation(fields: [projectId], references: [id])
  user                        User?              @relation(fields: [userId], references: [id])

  @@index([email])
  @@index([status])
  @@index([createdAt])
  @@index([invitedBy])
}

model DriveSettings {
  id              String   @id @default(cuid())
  userId          String   @unique
  favoriteFolders String[] @default([])
  defaultView     String   @default("grid")
  itemsPerPage    Int      @default(50)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model DriveFileCache {
  id           String   @id @default(cuid())
  googleFileId String   @unique
  name         String
  mimeType     String
  kind         String
  parentId     String?
  size         Int?
  thumbnailUrl String?
  lastSynced   DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([parentId])
  @@index([kind])
  @@index([lastSynced])
}

model Organization {
  id                     String                        @id @default(cuid())
  clerkOrgId             String                        @unique
  name                   String
  slug                   String                        @unique
  imageUrl               String?
  isActive               Boolean                       @default(true)
  maxMembers             Int                           @default(5)
  maxProjects            Int                           @default(10)
  creditsPerMonth        Int                           @default(1000)
  createdAt              DateTime                      @default(now())
  updatedAt              DateTime                      @updatedAt
  ownerClerkId           String?
  instagramDailySummary  InstagramDailySummary[]
  instagramFeeds         InstagramFeed[]
  instagramGoalSettings  InstagramGoalSettings[]
  instagramStories       InstagramStory[]
  instagramWeeklyReports InstagramWeeklyReport[]
  creditBalance          OrganizationCreditBalance?
  memberAnalytics        OrganizationMemberAnalytics[]
  projects               OrganizationProject[]
  usage                  OrganizationUsage[]
  Prompt                 Prompt[]
  usageHistory           UsageHistory[]

  @@index([clerkOrgId])
  @@index([slug])
  @@index([ownerClerkId])
}

model OrganizationCreditBalance {
  id             String       @id @default(cuid())
  organizationId String       @unique
  credits        Int          @default(0)
  lastRefill     DateTime?
  refillAmount   Int          @default(1000)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
}

model OrganizationUsage {
  id             String       @id @default(cuid())
  organizationId String
  userId         String
  feature        String
  credits        Int
  metadata       Json?
  createdAt      DateTime     @default(now())
  projectId      Int?
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  project        Project?     @relation(fields: [projectId], references: [id])

  @@index([organizationId])
  @@index([userId])
  @@index([createdAt])
  @@index([projectId])
}

model OrganizationProject {
  id             String       @id @default(cuid())
  organizationId String
  projectId      Int
  sharedBy       String
  sharedAt       DateTime     @default(now())
  defaultCanEdit Boolean      @default(true)
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  project        Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([organizationId, projectId])
  @@index([projectId])
  @@index([organizationId])
}

model StorageObject {
  id          String    @id @default(cuid())
  userId      String
  clerkUserId String
  provider    String    @default("vercel_blob")
  url         String
  pathname    String
  name        String
  contentType String?
  size        Int
  deletedAt   DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  User        User      @relation(fields: [userId], references: [id])

  @@index([clerkUserId])
  @@index([contentType])
  @@index([createdAt])
  @@index([deletedAt])
  @@index([name])
  @@index([userId])
}

model SubscriptionEvent {
  id          String   @id @default(cuid())
  userId      String?
  clerkUserId String
  planKey     String?
  status      String
  eventType   String
  occurredAt  DateTime @default(now())
  metadata    Json?
  createdAt   DateTime @default(now())
  User        User?    @relation(fields: [userId], references: [id])

  @@index([clerkUserId, occurredAt])
  @@index([userId, occurredAt])
}

model Template {
  id            Int          @id @default(autoincrement())
  name          String
  type          TemplateType
  dimensions    String
  designData    Json
  dynamicFields Json         @default("[]")
  thumbnailUrl  String?
  projectId     Int
  createdBy     String
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  category      String?
  isPremium     Boolean      @default(false)
  isPublic      Boolean      @default(false)
  tags          String[]     @default([])
  Generation    Generation[]
  Page          Page[]
  Project       Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([createdBy])
  @@index([projectId])
  @@index([type])
  @@index([category])
  @@index([isPublic])
}

model Page {
  id           String   @id @default(cuid())
  name         String
  width        Int
  height       Int
  layers       Json     @default("[]")
  background   String?
  order        Int      @default(0)
  thumbnail    String?
  templateId   Int
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  isTemplate   Boolean  @default(false)
  templateName String?
  Template     Template @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@index([templateId])
  @@index([order])
  @@index([isTemplate])
}

model UsageHistory {
  id              String        @id @default(cuid())
  userId          String
  creditBalanceId String
  operationType   OperationType
  creditsUsed     Int
  details         Json?
  timestamp       DateTime      @default(now())
  organizationId  String?
  CreditBalance   CreditBalance @relation(fields: [creditBalanceId], references: [id])
  Organization    Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  User            User          @relation(fields: [userId], references: [id])

  @@index([creditBalanceId])
  @@index([operationType])
  @@index([operationType, timestamp])
  @@index([timestamp])
  @@index([userId])
  @@index([userId, timestamp])
  @@index([organizationId, timestamp])
}

model OrganizationMemberAnalytics {
  id                    String       @id @default(cuid())
  organizationId        String
  memberClerkId         String
  memberUserId          String?
  imageGenerationsCount Int          @default(0)
  videoGenerationsCount Int          @default(0)
  chatInteractionsCount Int          @default(0)
  totalCreditsUsed      Int          @default(0)
  periodStart           DateTime
  periodEnd             DateTime
  lastActivityAt        DateTime?
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt
  member                User?        @relation(fields: [memberUserId], references: [id])
  organization          Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, memberClerkId, periodStart])
  @@index([organizationId, periodStart])
  @@index([memberClerkId])
  @@index([memberUserId])
  @@index([periodStart, periodEnd])
}

model User {
  id                          String                        @id @default(cuid())
  clerkId                     String                        @unique
  email                       String?                       @unique
  name                        String?
  isActive                    Boolean                       @default(true)
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime                      @updatedAt
  clientInvite                ClientInvite?
  CreditBalance               CreditBalance?
  driveSettings               DriveSettings?
  OrganizationMemberAnalytics OrganizationMemberAnalytics[]
  StorageObject               StorageObject[]
  SubscriptionEvent           SubscriptionEvent[]
  UsageHistory                UsageHistory[]

  @@index([createdAt])
  @@index([email])
  @@index([isActive])
  @@index([name])
}

model AIGeneratedImage {
  id            String      @id @default(cuid())
  projectId     Int
  name          String
  prompt        String
  mode          AIImageMode
  fileUrl       String
  thumbnailUrl  String?
  width         Int
  height        Int
  aspectRatio   String
  provider      String      @default("replicate")
  model         String
  predictionId  String?
  sourceImageId String?
  createdBy     String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  Project       Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([createdBy])
  @@index([mode])
  @@index([createdAt])
}

model KnowledgeBaseEntry {
  id          String            @id @default(cuid())
  title       String
  content     String
  tags        String[]
  status      EntryStatus       @default(ACTIVE)
  userId      String?
  workspaceId String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  projectId   Int
  category    KnowledgeCategory
  metadata    Json?
  createdBy   String
  updatedBy   String?
  expiresAt   DateTime?
  project     Project           @relation(fields: [projectId], references: [id], onDelete: Cascade)
  chunks      KnowledgeChunk[]

  @@index([projectId])
  @@index([projectId, category])
  @@index([projectId, status])
  @@index([userId])
  @@index([workspaceId])
  @@index([status])
  @@index([createdBy])
  @@index([expiresAt])
  @@index([projectId, expiresAt])
  @@map("knowledge_base_entries")
}

model KnowledgeChunk {
  id        String             @id @default(cuid())
  entryId   String
  ordinal   Int
  content   String
  tokens    Int?
  vectorId  String
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  entry     KnowledgeBaseEntry @relation(fields: [entryId], references: [id], onDelete: Cascade)

  @@unique([entryId, ordinal])
  @@index([entryId])
  @@map("knowledge_chunks")
}

model CMSPage {
  id          String        @id @default(cuid())
  title       String
  slug        String        @unique
  path        String        @unique
  description String?
  status      CMSPageStatus @default(DRAFT)
  isHome      Boolean       @default(false)
  metaTitle   String?
  metaDesc    String?
  ogImage     String?
  publishedAt DateTime?
  createdBy   String
  updatedBy   String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  sections    CMSSection[]

  @@index([slug])
  @@index([path])
  @@index([status])
  @@index([isHome])
  @@index([publishedAt])
}

model CMSSection {
  id         String         @id @default(cuid())
  pageId     String
  type       CMSSectionType
  name       String
  content    Json
  order      Int            @default(0)
  isVisible  Boolean        @default(true)
  cssClasses String?
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
  page       CMSPage        @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@index([pageId])
  @@index([type])
  @@index([order])
}

model CMSMenu {
  id        String        @id @default(cuid())
  name      String
  slug      String        @unique
  location  String
  isActive  Boolean       @default(true)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  items     CMSMenuItem[]

  @@index([slug])
  @@index([location])
}

model CMSMenuItem {
  id        String        @id @default(cuid())
  menuId    String
  label     String
  url       String
  target    String?       @default("_self")
  icon      String?
  order     Int           @default(0)
  parentId  String?
  isVisible Boolean       @default(true)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  menu      CMSMenu       @relation(fields: [menuId], references: [id], onDelete: Cascade)
  parent    CMSMenuItem?  @relation("MenuItemChildren", fields: [parentId], references: [id], onDelete: Cascade)
  children  CMSMenuItem[] @relation("MenuItemChildren")

  @@index([menuId])
  @@index([parentId])
  @@index([order])
}

model CMSComponent {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?
  type        String
  content     Json
  thumbnail   String?
  isGlobal    Boolean  @default(false)
  createdBy   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
  @@index([type])
  @@index([isGlobal])
}

model CMSMedia {
  id           String   @id @default(cuid())
  name         String
  filename     String
  url          String
  thumbnailUrl String?
  mimeType     String
  size         Int
  width        Int?
  height       Int?
  alt          String?
  caption      String?
  folder       String?
  uploadedBy   String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([folder])
  @@index([mimeType])
  @@index([uploadedBy])
}

model SiteSettings {
  id              String   @id @default(cuid())
  siteName        String   @default("Studio Lagosta")
  shortName       String   @default("Studio Lagosta")
  description     String
  logoLight       String   @default("/logo-light.svg")
  logoDark        String   @default("/logo-dark.svg")
  favicon         String   @default("/favicon.ico")
  appleIcon       String?
  metaTitle       String?
  metaDesc        String?
  ogImage         String?
  keywords        String[] @default([])
  supportEmail    String?
  twitter         String?
  facebook        String?
  instagram       String?
  linkedin        String?
  github          String?
  gtmId           String?
  gaId            String?
  facebookPixelId String?
  isActive        Boolean  @default(true)
  updatedBy       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  logoFullDark    String?
  logoFullLight   String?

  @@index([isActive])
}

model FeatureGridItem {
  id          String   @id @default(cuid())
  icon        String
  iconColor   String?
  title       String
  description String
  gridArea    String?
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdBy   String
  updatedBy   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([order])
  @@index([isActive])
}

model PromptLibrary {
  id        String   @id @default(cuid())
  title     String
  prompt    String
  category  String?
  projectId Int
  createdBy String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  Project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([createdBy])
}

model Prompt {
  id              String        @id @default(cuid())
  userId          String
  title           String
  content         String
  category        String?
  tags            String[]      @default([])
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  organizationId  String?
  referenceImages String[]      @default([])
  organization    Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([category])
  @@index([createdAt])
  @@index([organizationId])
}

model VideoProcessingJob {
  id              String                @id @default(cuid())
  userId          String
  clerkUserId     String
  templateId      Int
  projectId       Int
  status          VideoProcessingStatus @default(PENDING)
  webmBlobUrl     String
  webmFileSize    Int
  mp4ResultUrl    String?
  thumbnailUrl    String?
  videoName       String
  videoDuration   Float
  videoWidth      Int
  videoHeight     Int
  designData      Json
  progress        Int                   @default(0)
  errorMessage    String?
  createdAt       DateTime              @default(now())
  startedAt       DateTime?
  completedAt     DateTime?
  creditsDeducted Boolean               @default(false)
  creditsUsed     Int                   @default(10)
  generationId    String?               @unique
  audioFadeIn     Float?
  audioFadeOut    Float?
  audioLoop       Boolean?              @default(false)
  audioSource     String?
  audioVolume     Float?                @default(1.0)
  musicEndTime    Float?
  musicId         Int?
  musicStartTime  Float?
  generation      Generation?           @relation("GenerationVideoJob", fields: [generationId], references: [id])
  music           MusicLibrary?         @relation(fields: [musicId], references: [id])

  @@index([userId])
  @@index([clerkUserId])
  @@index([status])
  @@index([createdAt])
  @@index([templateId])
  @@index([projectId])
  @@index([musicId])
}

model SocialPost {
  id                   String             @id @default(cuid())
  projectId            Int
  generationId         String?
  userId               String
  postType             PostType
  caption              String
  mediaUrls            String[]
  altText              String[]           @default([])
  firstComment         String?
  scheduleType         ScheduleType
  scheduledDatetime    DateTime?
  recurringConfig      Json?
  status               PostStatus         @default(DRAFT)
  sentAt               DateTime?
  failedAt             DateTime?
  errorMessage         String?
  webhookResponse      Json?
  zapierWebhookUrl     String?
  isRecurring          Boolean            @default(false)
  parentPostId         String?
  originalScheduleType ScheduleType?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  publishType          PublishType        @default(DIRECT)
  blobPathnames        String[]           @default([])
  bufferId             String?
  bufferSentAt         DateTime?
  instagramMediaId     String?
  publishedUrl         String?
  verificationTag      String?
  verificationStatus   VerificationStatus @default(SKIPPED)
  verificationAttempts Int                @default(0)
  nextVerificationAt   DateTime?
  lastVerificationAt   DateTime?
  verifiedStoryId      String?
  verifiedPermalink    String?
  verifiedTimestamp    DateTime?
  verifiedByFallback   Boolean            @default(false)
  verificationError    String?
  laterPostId          String?
  analyticsComments    Int?
  analyticsEngagement  Int?
  analyticsFetchedAt   DateTime?
  analyticsImpressions Int?
  analyticsLikes       Int?
  analyticsReach       Int?
  analyticsShares      Int?
  lastSyncAt           DateTime?
  latePlatformUrl      String?
  latePublishedAt      DateTime?
  lateStatus           String?
  reminderExtraInfo    String?
  reminderSentAt       DateTime?
  processingStartedAt  DateTime?
  logs                 PostLog[]
  retries              PostRetry[]
  Generation           Generation?        @relation(fields: [generationId], references: [id])
  parentPost           SocialPost?        @relation("PostRecurrence", fields: [parentPostId], references: [id], onDelete: Cascade)
  childPosts           SocialPost[]       @relation("PostRecurrence")
  Project              Project            @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([userId])
  @@index([status])
  @@index([scheduledDatetime])
  @@index([createdAt])
  @@index([projectId, status])
  @@index([status, scheduledDatetime])
  @@index([scheduleType])
  @@index([generationId])
  @@index([parentPostId])
  @@index([verificationStatus, nextVerificationAt])
  @@index([verificationTag])
  @@index([projectId, scheduledDatetime])
  @@index([projectId, status, scheduleType])
  @@index([projectId, scheduleType, status])
  @@index([status, scheduleType, scheduledDatetime])
  @@index([laterPostId])
  @@index([laterPostId, status])
  @@index([status, lastSyncAt])
  @@index([status, analyticsFetchedAt])
  @@index([latePublishedAt])
  @@index([processingStartedAt])
}

model PostRetry {
  id            String      @id @default(cuid())
  postId        String
  attemptNumber Int
  scheduledFor  DateTime
  status        RetryStatus @default(PENDING)
  errorMessage  String?
  executedAt    DateTime?
  createdAt     DateTime    @default(now())
  post          SocialPost  @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([scheduledFor])
  @@index([status])
}

model PostLog {
  id        String       @id @default(cuid())
  postId    String
  event     PostLogEvent
  message   String
  metadata  Json?
  createdAt DateTime     @default(now())
  post      SocialPost   @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([createdAt])
  @@index([event])
}

model ChatConversation {
  id             String        @id @default(cuid())
  userId         String
  clerkUserId    String
  organizationId String?
  title          String        @default("Nova Conversa")
  lastMessageAt  DateTime      @default(now())
  expiresAt      DateTime
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  projectId      Int?
  project        Project?      @relation(fields: [projectId], references: [id], onDelete: Cascade)
  messages       ChatMessage[]

  @@index([userId])
  @@index([clerkUserId])
  @@index([organizationId])
  @@index([projectId])
  @@index([projectId, userId])
  @@index([lastMessageAt])
  @@index([expiresAt])
}

model ChatMessage {
  id             String           @id @default(cuid())
  conversationId String
  role           String
  content        String
  provider       String?
  model          String?
  attachments    Json?
  createdAt      DateTime         @default(now())
  metadata       Json?
  conversation   ChatConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([createdAt])
}

model InstagramStory {
  id             String             @id @default(cuid())
  projectId      Int
  organizationId String?
  mediaId        String             @unique
  username       String
  mediaType      InstagramMediaType
  mediaUrl       String
  thumbnailUrl   String?
  caption        String?
  publishedAt    DateTime
  capturedAt     DateTime
  impressions    Int                @default(0)
  reach          Int                @default(0)
  tapsForward    Int                @default(0)
  tapsBack       Int                @default(0)
  exits          Int                @default(0)
  replies        Int                @default(0)
  countedInGoal  Boolean            @default(true)
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  organization   Organization?      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  project        Project            @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([organizationId])
  @@index([username])
  @@index([publishedAt])
  @@index([countedInGoal])
  @@index([username, publishedAt])
}

model InstagramFeed {
  id             String             @id @default(cuid())
  projectId      Int
  organizationId String?
  mediaId        String             @unique
  username       String
  mediaType      InstagramMediaType
  caption        String?
  mediaUrl       String
  thumbnailUrl   String?
  permalink      String
  publishedAt    DateTime
  capturedAt     DateTime
  likes          Int                @default(0)
  comments       Int                @default(0)
  engagement     Int                @default(0)
  impressions    Int                @default(0)
  reach          Int                @default(0)
  saved          Int                @default(0)
  countedInGoal  Boolean            @default(true)
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  organization   Organization?      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  project        Project            @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([organizationId])
  @@index([username])
  @@index([publishedAt])
  @@index([countedInGoal])
  @@index([permalink])
  @@index([username, publishedAt])
}

model InstagramDailySummary {
  id                    String        @id @default(cuid())
  projectId             Int
  organizationId        String?
  username              String
  date                  DateTime      @db.Date
  storiesGoal           Int           @default(3)
  storiesPublished      Int           @default(0)
  feedsPublished        Int           @default(0)
  storiesCompletionRate Float         @default(0)
  goalMet               Boolean       @default(false)
  totalStoryReach       Int           @default(0)
  totalStoryImpressions Int           @default(0)
  totalFeedEngagement   Int           @default(0)
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  organization          Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  project               Project       @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, date])
  @@index([organizationId])
  @@index([username])
  @@index([date])
  @@index([goalMet])
}

model InstagramWeeklyReport {
  id                    String        @id @default(cuid())
  projectId             Int
  organizationId        String?
  username              String
  weekStart             DateTime      @db.Date
  weekEnd               DateTime      @db.Date
  year                  Int
  weekNumber            Int
  feedsGoal             Int           @default(4)
  storiesGoal           Int           @default(21)
  feedsPublished        Int           @default(0)
  storiesPublished      Int           @default(0)
  feedsCompletionRate   Float         @default(0)
  storiesCompletionRate Float         @default(0)
  overallCompletionRate Float         @default(0)
  score                 String        @db.Char(1)
  daysWithoutPost       Int           @default(0)
  bestPerformingFeedId  String?
  totalEngagement       Int           @default(0)
  metricsJson           Json
  alerts                Json?
  generatedAt           DateTime
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  organization          Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  project               Project       @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, weekStart])
  @@index([organizationId])
  @@index([username])
  @@index([weekStart])
  @@index([score])
  @@index([overallCompletionRate])
}

model InstagramGoalSettings {
  id             String        @id @default(cuid())
  projectId      Int           @unique
  organizationId String?
  weeklyFeedGoal Int           @default(4)
  dailyStoryGoal Int           @default(3)
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  project        Project       @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([isActive])
}

model MusicLibrary {
  id                  Int                  @id @default(autoincrement())
  name                String
  artist              String?
  duration            Float
  blobUrl             String
  blobSize            Int
  genre               String?
  mood                String?
  isActive            Boolean              @default(true)
  isPublic            Boolean              @default(true)
  thumbnailUrl        String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  createdBy           String?
  projectId           Int?
  stemsProcessedAt    DateTime?
  hasInstrumentalStem Boolean              @default(false)
  instrumentalSize    Int?
  instrumentalUrl     String?
  project             Project?             @relation("ProjectMusicLibrary", fields: [projectId], references: [id], onDelete: Cascade)
  stemJob             MusicStemJob?
  usedInVideos        VideoProcessingJob[]
  youtubeDownloadJob  YoutubeDownloadJob?  @relation("YoutubeDownloadMusic")

  @@index([projectId])
  @@index([genre])
  @@index([mood])
  @@index([isActive, isPublic])
  @@index([hasInstrumentalStem])
}

model MusicStemJob {
  id                Int          @id @default(autoincrement())
  musicId           Int          @unique
  status            String       @default("pending")
  progress          Int          @default(0)
  mvsepJobHash      String?
  mvsepStatus       String?
  percussionBlobUrl String?
  error             String?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  startedAt         DateTime?
  completedAt       DateTime?
  music             MusicLibrary @relation(fields: [musicId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([mvsepJobHash])
  @@index([createdAt])
}

model YoutubeDownloadJob {
  id              Int           @id @default(autoincrement())
  youtubeUrl      String
  youtubeId       String?
  requestedName   String?
  requestedArtist String?
  requestedGenre  String?
  requestedMood   String?
  projectId       Int?
  status          String        @default("pending")
  progress        Int           @default(0)
  videoApiJobId   String?
  videoApiStatus  String?
  musicId         Int?          @unique
  title           String?
  duration        Float?
  thumbnail       String?
  error           String?
  retryCount      Int           @default(0)
  createdBy       String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  startedAt       DateTime?
  completedAt     DateTime?
  music           MusicLibrary? @relation("YoutubeDownloadMusic", fields: [musicId], references: [id])
  project         Project?      @relation(fields: [projectId], references: [id])

  @@index([status])
  @@index([youtubeUrl])
  @@index([createdAt])
  @@index([videoApiJobId])
}

model AICreativeGeneration {
  id          String   @id @default(cuid())
  projectId   Int
  templateId  Int
  pageId      String
  layoutType  String
  imageSource Json
  textsData   Json
  creditsUsed Int      @default(0)
  createdBy   String
  createdAt   DateTime @default(now())

  @@index([projectId])
  @@index([templateId])
  @@index([createdBy])
  @@index([createdAt])
}

enum ClientInviteStatus {
  PENDING
  ACCEPTED
  COMPLETED
  CANCELLED
  EXPIRED
}

enum GenerationStatus {
  PROCESSING
  COMPLETED
  FAILED
}

enum OperationType {
  AI_TEXT_CHAT
  AI_IMAGE_GENERATION
  CREATIVE_DOWNLOAD
  VIDEO_EXPORT
  SOCIAL_MEDIA_POST
}

enum ProjectStatus {
  ACTIVE
  INACTIVE
  ARCHIVED
}

enum TemplateType {
  STORY
  FEED
  SQUARE
}

enum EntryStatus {
  ACTIVE
  DRAFT
  ARCHIVED
}

enum KnowledgeCategory {
  ESTABELECIMENTO_INFO
  HORARIOS
  CARDAPIO
  DELIVERY
  POLITICAS
  TOM_DE_VOZ
  CAMPANHAS
  DIFERENCIAIS
  FAQ
}

enum AIImageMode {
  GENERATE
  EDIT
  OUTPAINT
}

enum CMSPageStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum CMSSectionType {
  HERO
  BENTO_GRID
  FAQ
  AI_STARTER
  PRICING
  CTA
  CUSTOM
}

enum VideoProcessingStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum PostType {
  POST
  STORY
  REEL
  CAROUSEL
}

enum PostStatus {
  DRAFT
  SCHEDULED
  POSTING
  POSTED
  FAILED
}

enum VerificationStatus {
  PENDING
  VERIFIED
  VERIFICATION_FAILED
  SKIPPED
}

enum ScheduleType {
  IMMEDIATE
  SCHEDULED
  RECURRING
}

enum RecurrenceFrequency {
  DAILY
  WEEKLY
  MONTHLY
}

enum PublishType {
  DIRECT
  REMINDER
}

enum PostingProvider {
  ZAPIER
  LATER
}

enum PostLogEvent {
  CREATED
  SCHEDULED
  SENT
  FAILED
  RETRIED
  CANCELLED
  EDITED
}

enum RetryStatus {
  PENDING
  PROCESSING
  SUCCESS
  FAILED
}

enum InstagramMediaType {
  IMAGE
  VIDEO
  CAROUSEL_ALBUM
}
